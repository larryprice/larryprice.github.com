
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Larry Price</title>
  <meta name="author" content="Larry Price">

  
  <meta name="description" content="Noty is a jQuery plugin for showing flash messages. Noty is easy to use and creates great-looking flash notifications with little customization. What &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://larry-price.com/posts/8">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Larry Price" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat+Alternates|Marcellus' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35669093-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner" style="background:url(/images/coffee-stain.png) top right no-repeat; background-size: auto 100%;"><hgroup>
  <h1><a href="/">Larry Price</a></h1>
  
    <h2>And The Endless Cup Of Coffee</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:larry-price.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/books">Books</a></li>
  <li><a href="/blog/projects">Projects</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/01/noty-for-easy/">Noty for Easy, Breezy, Beautiful Flash Messages</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-01T18:29:27-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>6:29 pm</span></time>
        
           | <a href="/blog/2015/09/01/noty-for-easy/#disqus_thread"
             data-disqus-identifier="https://larry-price.com/blog/2015/09/01/noty-for-easy/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://ned.im/noty/#/about">Noty</a> is a jQuery plugin for showing flash messages. Noty is easy to use and creates great-looking flash notifications with little customization.</p>

<h4>What&rsquo;s a flash message?</h4>

<p>Flash messages are used to display small bits of information to a user without changing existing page content. If there is an error making an AJAX request, we can display an error flash message to let the user know to try again later. If there is a new shortcut available, we could let the user know with an information flash message.</p>

<h4>Example Time</h4>

<p>You&rsquo;ll need a copy of Noty. As of this time, I haven&rsquo;t seen a CDN hosting the minified version of Noty, so you can download it <a href="https://raw.githubusercontent.com/needim/noty/master/js/noty/packaged/jquery.noty.packaged.min.js">directly from Github</a> and put it somewhere nice. Add a <code>&lt;script&gt;</code> tag to your HTML including the library and let&rsquo;s start using it.</p>

<p>Let&rsquo;s create a single button on our HTML page that, when clicked, will create a new Noty error flash message in the top left.</p>

<iframe style="width: 100%; height: 150px" frameborder="0" seamless="seamless" src="//jsfiddle.net/f14xjf8b/embedded/result,html,js/light/"></iframe>


<p>Cool, right? Break it down:</p>

<ul>
<li>text

<ul>
<li>Obviously, this is the text that will be displayed</li>
</ul>
</li>
<li>layout

<ul>
<li>This allows us to change the position of the flash message. In this case I chose <code>topleft</code>, but other options include <code>top</code>, <code>topCenter</code>, <code>topRight</code>, <code>center</code>, <code>centerLeft</code>, <code>centerRight</code>, <code>bottom</code>, <code>bottomLeft</code>, <code>bottomCenter</code>, and <code>bottomRight</code></li>
</ul>
</li>
<li>timeout

<ul>
<li>How long the notification will stay on the screen (in milliseconds). <code>false</code> for a permanant notification.</li>
</ul>
</li>
<li>type

<ul>
<li>Style of notification to display. Options include <code>error</code>, <code>success</code>, <code>alert</code>, <code>warning</code>, <code>confirmation</code>, and <code>information</code>.</li>
</ul>
</li>
</ul>


<p> Let&rsquo;s add some more so we can see the difference.</p>

<p> <iframe style="width: 100%; height: 150px" frameborder="0" seamless="seamless" src="//jsfiddle.net/f14xjf8b/2/embedded/result,html,js/light/"></iframe></p>

<p> Three notifications, one which stays up for 500ms, one which stays up for 5000ms, and one which stays up indefinitely. I also set the <code>killer</code> property to true on the <code>error</code> notification such that the <code>error</code> notification will close all other notifications. Additionally, I added the <code>closeWith</code> property to the <code>success</code> message to close it by clicking. All of these notifications come up in different locations on the page.</p>

<p> We should also think about theming our notifications. To create a &ldquo;full&rdquo; theme for Noty is a lot of Javascript -  the odds are pretty good you just want to change the color. We can essentially inherit from the default theme and change the colors of the <code>error</code> and <code>information</code> notifictaions in our new theme like this:</p>

<figure class='code'><figcaption><span>testtheme.noty.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">noty</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">testtheme</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">noty</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">);</span>
</span><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">noty</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">testtheme</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;testtheme&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">noty</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">testtheme</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">noty</span><span class="p">.</span><span class="nx">themes</span><span class="p">.</span><span class="nx">defaultTheme</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="s1">&#39;error&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">$bar</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span class='line'>                <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#DC569F&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">borderColor</span><span class="o">:</span> <span class="s1">&#39;#DC569F&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#F5F5F5&#39;</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="s1">&#39;information&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="nx">$bar</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span class='line'>                <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#ABABAB&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">borderColor</span><span class="o">:</span> <span class="s1">&#39;#DC569F&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#F5F5F5&#39;</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$message</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">fontWeight</span><span class="o">:</span> <span class="s1">&#39;bold&#39;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p> We create our new theme <code>testtheme</code> from the <code>defaultTheme</code> prototype and change the <code>name</code> and <code>style</code> properties. Within our custom <code>style</code> function, we go ahead and apply the default theme&rsquo;s style. Then we add a few more adjustments based on the current notification type. Thank goodness it&rsquo;s javascript. Don&rsquo;t forget to include your <code>testtheme.noty.js</code> file in a <code>&lt;script&gt;</code> tag in your HTML. We can apply this theme to any of our notifications by adding the <code>theme</code> property to our call to <code>noty</code> with a value of &lsquo;testtheme&rsquo; (which is the name of the theme we just created). Here&rsquo;s the fiddle showing off our new theme:</p>

<p> <iframe style="width: 100%; height: 150px" frameborder="0" seamless="seamless" src="//jsfiddle.net/f14xjf8b/3/embedded/result,html,js/light/"></iframe></p>

<p> There are many other customization options for the brave, including custom animations and callbacks when the notifications are dismissed. See <a href="http://ned.im/noty/#/about">the full documentation site</a> for more details.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/02/extreme-programming-explained/">Extreme Programming Explained</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-02T20:14:49-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>8:14 pm</span></time>
        
           | <a href="/blog/2015/08/02/extreme-programming-explained/#disqus_thread"
             data-disqus-identifier="https://larry-price.com/blog/2015/08/02/extreme-programming-explained/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The Gist</h3>

<p><a href="http://amzn.to/1KKM3Q0"><em>Extreme Programming Explained</em></a> is the <em>de facto</em> book on XP written by Kent Beck. In the world of XP, software development is fun and efficient. Communication is open between all parties, pair programming is mandatory, builds are short, and tests are written before production code. Beck invites the reader to apply bits and pieces of XP to the development process to see incremental improvements, which is a very XP way of implementing XP.</p>

<h3>Takeaways</h3>

<p>XP is about solving people problems. Nearly every challenge we face during software development is caused by dealing with people. Communication is key to fixing most of these problems. On a developer level, pair programming and colocation form closer relationships and cause more conversations to occur.</p>

<p>Do everything in small chunks. Whether you are designing a user experience, architecting a system, or estimating stories you should only address as little as <em>responsible</em> at a time. This means architect a small system first and adapt as a more complex architecture becomes necessary instead of doing it all at once. Create a user interface for the next week&rsquo;s worth of work instead of the whole project. Small chunks means tighter feedback loops and less wasted effort when specs change (and they will change).</p>

<p>Software is built by people. People don&rsquo;t like to be referred to as &ldquo;cogs in a machine.&rdquo; People make mistakes and people create (process) waste. People like to think they are contributing to the success of the company and they like to feel good about what they are creating.</p>

<p>10-minute builds. Beck claims that the perfect build takes 10 minutes; anything more makes people not want to wait for it to finish and anything less isn&rsquo;t enough time to take a coffee break. This concept is not for your constant, at-your-desk 10-second build. When I push my code to the server, it will compile a clean build and run every regression and integration and UX test within 10 minutes. If your regular, 100 times a day desktop build takes more than 10 minutes, you may want to see a shrink.</p>

<p>Teammates should have disagreements but not knife fights (at least not while on the clock). If there are no dissenting opinions about how to implement something you may never find the most efficient answer.</p>

<p>Automated tests are a man&rsquo;s best friend. Tests are a contract describing what the code currently does. Tests can be run by any programmer to verify a working system.</p>

<p>Did I mention test-first development? I&rsquo;ve been through TDD trainings and found testing first difficult to follow strictly. The point of writing your tests first is to prevent any unwanted or undocumented side-effects in the code you just wrote. If you can delete a line of code and the tests still pass, that line of code is either unnecessary or untested.</p>

<p>Taking baby steps is okay. It&rsquo;s unlikely you&rsquo;ll be able to institute all the great changes recommended by XP. Start by figuring out how to get your 15-minute build under 10 minutes. &ldquo;Force&rdquo; your usually unwilling teammate to pair with you when working on a piece of code within said teammate&rsquo;s area of expertise. Take a piece of untested code and wrap it in tests.</p>

<h3>My Action Items</h3>

<ul>
<li>Write more tests. I&rsquo;ve been having a tough time getting tests written in this current project because it&rsquo;s largely UI and initializing a provided library. This week I want to come out net-positive on tests.</li>
<li>Test first. I&rsquo;ve accomplished this on a few occasions, including a recent bug fix I pushed to an open-source library I created. But this is hard. I have a tendency to dive in headfirst when a test could help set the stage for a simpler design.</li>
<li>1-week iterations. I have pushed against 1-week iterations because I often found them to be &ldquo;too short,&rdquo; but I&rsquo;m starting to come around to the idea of getting 1-2 items done per developer (or pair) per iteration. Other benefits include shorter feedback loop and less estimation required. My current project is a team of one, so this action item might have to sit on the backburner for a few months.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/19/muck-with-history-using-the-html5-history-api/">Muck With History Using the HTML5 History API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-19T11:00:00-04:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:00 am</span></time>
        
           | <a href="/blog/2015/07/19/muck-with-history-using-the-html5-history-api/#disqus_thread"
             data-disqus-identifier="https://larry-price.com/blog/2015/07/19/muck-with-history-using-the-html5-history-api/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Congratulations! You just made a single page web application [SPWA] to do All The Things. What happens when you hit the Back button in the browser? Oops.</p>

<p>The Back button is <a href="http://www.internetnews.com/skerner/2010/07/what-is-the-most-clicked-firef.html">the most used navigation button in the modern browser</a>. SPWA often break the functionality of the Back button. We can fix this using the <a href="http://diveintohtml5.info/history.html">HTML 5 History API</a>.</p>

<p>For this demo, I&rsquo;ll make a simple web page starting with the text &ldquo;Page 1&rdquo; and a &ldquo;Continue&rdquo; button. When I click the &ldquo;Continue&rdquo; button, &ldquo;Welcome&rdquo; will change to &ldquo;Page 1&rdquo;; when I click &ldquo;Page 1&rdquo;, I change to &ldquo;Page 2&rdquo;; ad infinitum. My initial page looks like this:</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span> <span class="na">style=</span><span class="s">&quot;margin-bottom: 1.5em;&quot;</span><span class="nt">&gt;</span>Welcome<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;continue&quot;</span> <span class="na">onclick=</span><span class="s">&quot;nextPage()&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  Continue
</span><span class='line'><span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">nextPage</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="s2">&quot;Welcome&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Page &quot;</span> <span class="o">+</span> <span class="nx">pageNumber</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running this code and clicking &ldquo;Continue&rdquo;, the user has no way to go back. He or she would need to start over from the beginning, which is bad for the user and bad for us too. We can update the browser&rsquo;s history using <code>pushState</code> and <code>popState</code> commands from the History API. For this contrived example, I&rsquo;ll add my <code>pushState</code> call in the <code>nextPage</code> function:</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">nextPage</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">),</span>
</span><span class='line'>      <span class="nx">nextPage</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="s2">&quot;Welcome&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">nextPage</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;?page=&quot;</span> <span class="o">+</span> <span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the site will add <code>?page=</code> to the URL whenever we update the page number. This happens when we call <code>history.pushState</code>. In the call to <code>history.pushState</code>, the first argument is some data identifying the state, the second argument is the <code>title</code> of the new page but is currently unused by all the major browsers, and the third argument is the URL of the new state.</p>

<p>In doing this, the Back button has become enabled in the browser. However, it still doesn&rsquo;t work. That&rsquo;s where <code>popState</code> comes in. <code>popState</code> is the other side of the equation which figures out how to change the page when the user hits the Back button. I&rsquo;ll update the call to <code>pushState</code> to include the page number in the <code>state</code> arugment so we can use it.</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">nextPage</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">),</span>
</span><span class='line'>      <span class="nx">nextPage</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="s2">&quot;Welcome&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">nextPage</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;?page=&quot;</span> <span class="o">+</span> <span class="nx">nextPage</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">pageNumber</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Welcome&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">content</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Page &quot;</span> <span class="o">+</span> <span class="nx">pageNumber</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">onpopstate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">state</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now your history should be <em>mostly</em> working. Hitting Back should take you to the previous page, then hitting Forward should take you to the next page.</p>

<p>There is currently a bug in the version of webkit Safari uses which causes a <code>popstate</code> event to fire on initial page load. We can try to fix this using the <code>replaceState</code> call on page load to set our history&rsquo;s state to the initial value. You can add this event to the bottom of your javascript:</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ... </span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, I want my web page to be smarter than this. If the user explicitly visits &ldquo;mysweetpage.com?page=3&rdquo; I want the user to be presented with page 3&rsquo;s epic content. Let&rsquo;s modify that <code>onload</code> function to check the current URL state and figure out which page the user has visited:</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">updatePageContent</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">(</span><span class="nx">currentPage</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>History changed. Forever. Changing history is a good idea but can easily lead to an even more confusing user scenario. Choose when to change history based on when your application would traditionally need to bring up a new page. Once you have Back working, make sure Forward also acts as expected. Thinking about how you&rsquo;ll integrate the History API into your web application can help you write more sensible, modular code.</p>

<p>If you&rsquo;re looking for the full code that we created above, check out <a href="https://gist.github.com/larryprice/b06dd00c3e7f63ae7954">this gist</a>.</p>

<p>&lt;3 HTML5</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/25/architecture-for-a-golang-web-app/">Architecture for a Golang Web App</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-25T07:24:27-04:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:24 am</span></time>
        
           | <a href="/blog/2015/06/25/architecture-for-a-golang-web-app/#disqus_thread"
             data-disqus-identifier="https://larry-price.com/blog/2015/06/25/architecture-for-a-golang-web-app/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Setting up a web application in Golang can be a daunting task. If you&rsquo;re used to rails, you probably miss having your hand held at this point. I&rsquo;m using this architecture on <a href="https://www.refer-madness.com">Refer Madness</a> [<a href="https://github.com/larryprice/refermadness">source</a>]. Here&rsquo;s my directory structure:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-public/
</span><span class='line'>-views/
</span><span class='line'>-models/
</span><span class='line'>-utils/
</span><span class='line'>-controllers/
</span><span class='line'>-web/
</span><span class='line'>-main.go</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll break this down architecturally. At each directory level, files are only allowed to access code from directories at the same or a higher level. This means that <code>utils</code> can access itself and <code>models</code>; <code>web</code> can access itself, <code>controllers</code>, <code>utils</code>, and <code>models</code>; and <code>models</code> can only access itself. I do this to keep a thick line between all the layers and to avoid recursive dependencies. Let&rsquo;s talk about each level individually!</p>

<h4>main.go</h4>

<p><code>main.go</code> is my main file in charge of creating dependencies, discovering environment variables, and starting the web server. Here&rsquo;s a sample:</p>

<figure class='code'><figcaption><span>main.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/utils&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/web&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/stretchr/graceful&quot;</span>
</span><span class='line'>  <span class="s">&quot;os&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">isDevelopment</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;ENVIRONMENT&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;development&quot;</span>
</span><span class='line'>  <span class="nx">dbURL</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;MONGOLAB_URI&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">isDevelopment</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">dbURL</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;DB_PORT_27017_TCP_ADDR&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">dbAccessor</span> <span class="o">:=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">NewDatabaseAccessor</span><span class="p">(</span><span class="nx">dbURL</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;DATABASE_NAME&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">cuAccessor</span> <span class="o">:=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">NewCurrentUserAccessor</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">s</span> <span class="o">:=</span> <span class="nx">web</span><span class="p">.</span><span class="nx">NewServer</span><span class="p">(</span><span class="o">*</span><span class="nx">dbAccessor</span><span class="p">,</span> <span class="o">*</span><span class="nx">cuAccessor</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOOGLE_OAUTH2_CLIENT_ID&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOOGLE_OAUTH2_CLIENT_SECRET&quot;</span><span class="p">),</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;SESSION_SECRET&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">isDevelopment</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOOGLE_ANALYTICS_KEY&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">port</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;PORT&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">port</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">port</span> <span class="p">=</span> <span class="s">&quot;3000&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">graceful</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="o">+</span><span class="nx">port</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since <code>main.go</code> is on the lowest level, it has access to every other directory: in this case, <code>utils</code> and <code>web</code>. I grab all the environment variables and inject them where necessary. I create the server, injecting dependencies, and then start it on the port I want.</p>

<h4>web</h4>

<p>I keep my server code in the <code>web</code> directory, which includes some web middleware. Here&rsquo;s the internal structure of the <code>web</code> directory:</p>

<figure class='code'><figcaption><span>main.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="o">-</span><span class="nx">web</span><span class="o">/</span>
</span><span class='line'><span class="p">|</span><span class="o">-</span><span class="nx">middleware</span><span class="o">/</span>
</span><span class='line'><span class="p">|</span><span class="o">-</span><span class="nx">server</span><span class="p">.</span><span class="k">go</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>server.go</code> contains the definition of my web server. The web server creates all my web controllers and adds middleware to my negroni server. Here&rsquo;s an excerpt:</p>

<figure class='code'><figcaption><span>web/server.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">web</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;github.com/codegangsta/negroni&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/goincremental/negroni-sessions&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/goincremental/negroni-sessions/cookiestore&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/gorilla/mux&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/controllers&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/utils&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/web/middleware&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/unrolled/secure&quot;</span>
</span><span class='line'>  <span class="s">&quot;gopkg.in/unrolled/render.v1&quot;</span>
</span><span class='line'>  <span class="s">&quot;html/template&quot;</span>
</span><span class='line'>  <span class="s">&quot;net/http&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">*</span><span class="nx">negroni</span><span class="p">.</span><span class="nx">Negroni</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">NewServer</span><span class="p">(</span><span class="nx">dba</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">DatabaseAccessor</span><span class="p">,</span> <span class="nx">cua</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">CurrentUserAccessor</span><span class="p">,</span> <span class="nx">clientID</span><span class="p">,</span> <span class="nx">clientSecret</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">sessionSecret</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">isDevelopment</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">gaKey</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Server</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">s</span> <span class="o">:=</span> <span class="nx">Server</span><span class="p">{</span><span class="nx">negroni</span><span class="p">.</span><span class="nx">Classic</span><span class="p">()}</span>
</span><span class='line'>  <span class="nx">session</span> <span class="o">:=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">NewSessionManager</span><span class="p">()</span>
</span><span class='line'>  <span class="nx">basePage</span> <span class="o">:=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">NewBasePageCreator</span><span class="p">(</span><span class="nx">cua</span><span class="p">,</span> <span class="nx">gaKey</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">renderer</span> <span class="o">:=</span> <span class="nx">render</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">router</span> <span class="o">:=</span> <span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">accountController</span> <span class="o">:=</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">NewAccountController</span><span class="p">(</span><span class="nx">clientID</span><span class="p">,</span> <span class="nx">clientSecret</span><span class="p">,</span> <span class="nx">isDevelopment</span><span class="p">,</span> <span class="nx">session</span><span class="p">,</span> <span class="nx">dba</span><span class="p">,</span> <span class="nx">cua</span><span class="p">,</span> <span class="nx">basePage</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">accountController</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="nx">router</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">s</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">Sessions</span><span class="p">(</span><span class="s">&quot;refermadness&quot;</span><span class="p">,</span> <span class="nx">cookiestore</span><span class="p">.</span><span class="nx">New</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">sessionSecret</span><span class="p">))))</span>
</span><span class='line'>  <span class="nx">s</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">middleware</span><span class="p">.</span><span class="nx">NewAuthenticator</span><span class="p">(</span><span class="nx">dba</span><span class="p">,</span> <span class="nx">session</span><span class="p">,</span> <span class="nx">cua</span><span class="p">).</span><span class="nx">Middleware</span><span class="p">())</span>
</span><span class='line'>  <span class="nx">s</span><span class="p">.</span><span class="nx">UseHandler</span><span class="p">(</span><span class="nx">router</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">s</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A <code>server</code> struct is a <code>negroni.Negroni</code> web server. I create some dependencies from <code>utils</code> and external packages, create a router, create controllers with the dependencies, and register the router with my controllers. I also add in any middleware I may need. Speaking of middleware, here&rsquo;s an example:</p>

<figure class='code'><figcaption><span>web/middleware/database.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">middleware</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;github.com/codegangsta/negroni&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/utils&quot;</span>
</span><span class='line'>  <span class="s">&quot;net/http&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Database</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">da</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">DatabaseAccessor</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">NewDatabase</span><span class="p">(</span><span class="nx">da</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">DatabaseAccessor</span><span class="p">)</span> <span class="o">*</span><span class="nx">Database</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Database</span><span class="p">{</span><span class="nx">da</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">Database</span><span class="p">)</span> <span class="nx">Middleware</span><span class="p">()</span> <span class="nx">negroni</span><span class="p">.</span><span class="nx">HandlerFunc</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">rw</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">next</span> <span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">reqSession</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">da</span><span class="p">.</span><span class="nx">Clone</span><span class="p">()</span>
</span><span class='line'>    <span class="k">defer</span> <span class="nx">reqSession</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">da</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">reqSession</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">next</span><span class="p">(</span><span class="nx">rw</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a standard middleware definition for accessing a database session from an HTTP route. The base of this file was taken from <a href="http://modocache.svbtle.com/restful-go">Brian Gesiak&rsquo;s blog post on RESTful Go</a> and was modifiedto fit my needs.</p>

<h4>controllers/</h4>

<p>A controller is similar to the controller concept found in Rails. A controller registers its own route with the router provided and then sets up function calls. An abbreviated example:</p>

<figure class='code'><figcaption><span>controllers/service_controller.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">controllers</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;encoding/json&quot;</span>
</span><span class='line'>  <span class="s">&quot;errors&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/gorilla/mux&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/models&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/utils&quot;</span>
</span><span class='line'>  <span class="s">&quot;gopkg.in/mgo.v2/bson&quot;</span>
</span><span class='line'>  <span class="s">&quot;gopkg.in/unrolled/render.v1&quot;</span>
</span><span class='line'>  <span class="s">&quot;html/template&quot;</span>
</span><span class='line'>  <span class="s">&quot;net/http&quot;</span>
</span><span class='line'>  <span class="s">&quot;strings&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">ServiceControllerImpl</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">currentUser</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">CurrentUserAccessor</span>
</span><span class='line'>  <span class="nx">basePage</span>    <span class="nx">utils</span><span class="p">.</span><span class="nx">BasePageCreator</span>
</span><span class='line'>  <span class="nx">renderer</span>    <span class="o">*</span><span class="nx">render</span><span class="p">.</span><span class="nx">Render</span>
</span><span class='line'>  <span class="nx">database</span>    <span class="nx">utils</span><span class="p">.</span><span class="nx">DatabaseAccessor</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">NewServiceController</span><span class="p">(</span><span class="nx">currentUser</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">CurrentUserAccessor</span><span class="p">,</span> <span class="nx">basePage</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">BasePageCreator</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">renderer</span> <span class="o">*</span><span class="nx">render</span><span class="p">.</span><span class="nx">Render</span><span class="p">,</span> <span class="nx">database</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">DatabaseAccessor</span><span class="p">)</span> <span class="o">*</span><span class="nx">ServiceControllerImpl</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">ServiceControllerImpl</span><span class="p">{</span>
</span><span class='line'>    <span class="nx">currentUser</span><span class="p">:</span> <span class="nx">currentUser</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">basePage</span><span class="p">:</span>    <span class="nx">basePage</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">renderer</span><span class="p">:</span>    <span class="nx">renderer</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">database</span><span class="p">:</span>    <span class="nx">database</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="o">*</span><span class="nx">ServiceControllerImpl</span><span class="p">)</span> <span class="nx">Register</span><span class="p">(</span><span class="nx">router</span> <span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/service/{id}&quot;</span><span class="p">,</span> <span class="nx">sc</span><span class="p">.</span><span class="nx">single</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">serviceResult</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Service</span>
</span><span class='line'>  <span class="nx">RandomCode</span> <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">ReferralCode</span>
</span><span class='line'>  <span class="nx">UserCode</span>   <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">ReferralCode</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">servicePage</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">utils</span><span class="p">.</span><span class="nx">BasePage</span>
</span><span class='line'>  <span class="nx">ResultString</span> <span class="kt">string</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">sc</span> <span class="o">*</span><span class="nx">ServiceControllerImpl</span><span class="p">)</span> <span class="nx">single</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sc</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">[</span><span class="s">&quot;Content-Type&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">[</span><span class="s">&quot;Content-Type&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;application/json&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">sc</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>      <span class="k">return</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">sc</span><span class="p">.</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">resultString</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">t</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">ParseFiles</span><span class="p">(</span><span class="s">&quot;views/layout.html&quot;</span><span class="p">,</span> <span class="s">&quot;views/service.html&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">t</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">servicePage</span><span class="p">{</span><span class="nx">sc</span><span class="p">.</span><span class="nx">basePage</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span> <span class="nb">string</span><span class="p">(</span><span class="nx">resultString</span><span class="p">)})</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<h4>utils/</h4>

<p>Files that belong in the <code>utils</code> directory provide small levels of functionality to support the rest of the codebase. In my case, I have structs which access the request context, manipulate the session, and define a base page for specific pages to inherit. Here&rsquo;s where I access the context to set the user:</p>

<figure class='code'><figcaption><span>utils/current_user_accessor.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">utils</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;github.com/gorilla/context&quot;</span>
</span><span class='line'>  <span class="s">&quot;github.com/larryprice/refermadness/models&quot;</span>
</span><span class='line'>  <span class="s">&quot;net/http&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">CurrentUserAccessor</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">key</span> <span class="kt">int</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">NewCurrentUserAccessor</span><span class="p">(</span><span class="nx">key</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">CurrentUserAccessor</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">CurrentUserAccessor</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">cua</span> <span class="o">*</span><span class="nx">CurrentUserAccessor</span><span class="p">)</span> <span class="nx">Set</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">user</span> <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">cua</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">cua</span> <span class="o">*</span><span class="nx">CurrentUserAccessor</span><span class="p">)</span> <span class="nx">Clear</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">cua</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">cua</span> <span class="o">*</span><span class="nx">CurrentUserAccessor</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">rv</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">cua</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span> <span class="nx">rv</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">rv</span><span class="p">.(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">nil</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>models/</h4>

<p>Models are data structures for representing my database concepts. I use my models to access the database - I create an empty model and then populate it with a database query. Here&rsquo;s an example of a model I use:</p>

<figure class='code'><figcaption><span>models/service.go</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">models</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="p">(</span>
</span><span class='line'>  <span class="s">&quot;gopkg.in/mgo.v2&quot;</span>
</span><span class='line'>  <span class="s">&quot;gopkg.in/mgo.v2/bson&quot;</span>
</span><span class='line'>  <span class="s">&quot;strings&quot;</span>
</span><span class='line'>  <span class="s">&quot;time&quot;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Service</span> <span class="kd">struct</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// identification information</span>
</span><span class='line'>  <span class="nx">ID</span>          <span class="nx">bson</span><span class="p">.</span><span class="nx">ObjectId</span> <span class="s">`bson:&quot;_id&quot;`</span>
</span><span class='line'>  <span class="nx">Name</span>        <span class="kt">string</span>        <span class="s">`bson:&quot;name&quot;`</span>
</span><span class='line'>  <span class="nx">Description</span> <span class="kt">string</span>        <span class="s">`bson:&quot;description&quot;`</span>
</span><span class='line'>  <span class="nx">URL</span>         <span class="kt">string</span>        <span class="s">`bson:&quot;url&quot;`</span>
</span><span class='line'>  <span class="nx">Search</span>      <span class="kt">string</span>        <span class="s">`bson:&quot;search&quot;`</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">NewService</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="nx">url</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">creatorID</span> <span class="nx">bson</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">)</span> <span class="o">*</span><span class="nx">Service</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">url</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">TrimPrefix</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimPrefix</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="s">&quot;http://&quot;</span><span class="p">),</span> <span class="s">&quot;https://&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Service</span><span class="p">{</span>
</span><span class='line'>    <span class="nx">ID</span><span class="p">:</span>            <span class="nx">bson</span><span class="p">.</span><span class="nx">NewObjectId</span><span class="p">(),</span>
</span><span class='line'>    <span class="nx">Name</span><span class="p">:</span>          <span class="nx">name</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">URL</span><span class="p">:</span>           <span class="nx">url</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">Description</span><span class="p">:</span>   <span class="nx">description</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">Search</span><span class="p">:</span>        <span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">description</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">url</span><span class="p">),</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Service</span><span class="p">)</span> <span class="nx">Save</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">coll</span><span class="p">(</span><span class="nx">db</span><span class="p">).</span><span class="nx">UpsertId</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">err</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Service</span><span class="p">)</span> <span class="nx">FindByID</span><span class="p">(</span><span class="nx">id</span> <span class="nx">bson</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">db</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">coll</span><span class="p">(</span><span class="nx">db</span><span class="p">).</span><span class="nx">FindId</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">Service</span><span class="p">)</span> <span class="nx">coll</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Collection</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">C</span><span class="p">(</span><span class="s">&quot;service&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">type</span> <span class="nx">Services</span> <span class="p">[]</span><span class="nx">Service</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Services</span><span class="p">)</span> <span class="nx">FindByIDs</span><span class="p">(</span><span class="nx">ids</span> <span class="p">[]</span><span class="nx">bson</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="nx">db</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">coll</span><span class="p">(</span><span class="nx">db</span><span class="p">).</span><span class="nx">Find</span><span class="p">(</span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$in&quot;</span><span class="p">:</span> <span class="nx">ids</span><span class="p">}}).</span><span class="nx">Sort</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">Services</span><span class="p">)</span> <span class="nx">coll</span><span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span> <span class="o">*</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Collection</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">C</span><span class="p">(</span><span class="s">&quot;service&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<h4>views/</h4>

<p>I keep my goalng templates in the <code>views</code> directory. Pretty basic - whatever templating engine I use, I throw it into this <code>views</code> directory.</p>

<h4>public/</h4>

<p>As usual, this directory is all my public files - <code>css</code>, <code>img</code>, <code>scripts</code>.</p>

<h3>That&rsquo;s cool - how do I run this?</h3>

<p>It&rsquo;s no secret that I like <a href="https://www.docker.com/">docker</a>, so that&rsquo;s my preferred method of running this application. If I wanted to run this without docker, I would throw the root of this directory into <code>$GOPATH/src/github.com/larryprice/refermadness</code>. Running <code>go get</code> will fetch all the missing dependencies and running <code>go run main.go</code> or <code>go build; ./refermadness</code> should run the file. If you do want to use docker (and you know I do), I start with a <code>Dockerfile</code>:</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> golang:1.4
</span><span class='line'>
</span><span class='line'><span class="k">RUN</span> go get github.com/codegangsta/gin
</span><span class='line'>
</span><span class='line'><span class="k">ADD</span> . /go/src/github.com/larryprice/refermadness
</span><span class='line'><span class="k">WORKDIR</span> /go/src/github.com/larryprice/refermadness
</span><span class='line'><span class="k">RUN</span> go get
</span></code></pre></td></tr></table></div></figure>


<p>And, since I also love <a href="https://github.com/docker/compose">compose</a>, I run everything with a compose file. I use a JSC transformer, a SASS transpiler, and a mongo database, so my <code>docker-compose.yml</code> file looks like:</p>

<figure class='code'><figcaption><span>docker-compose.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">main</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">gin run</span>
</span><span class='line'>  <span class="l-Scalar-Plain">env_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.env</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./:/go/src/github.com/larryprice/refermadness</span>
</span><span class='line'>  <span class="l-Scalar-Plain">working_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/go/src/github.com/larryprice/refermadness</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="s">&quot;3000:3000&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">db</span>
</span><span class='line'><span class="l-Scalar-Plain">sass</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">larryprice/sass</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./public/css:/src</span>
</span><span class='line'><span class="l-Scalar-Plain">jsx</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">larryprice/jsx</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./public/scripts:/src</span>
</span><span class='line'><span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mongo:3.0</span>
</span><span class='line'>  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mongod --smallfiles --quiet --logpath=/dev/null</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes_from</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">dbvolume</span>
</span><span class='line'><span class="l-Scalar-Plain">dbvolume</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">busybox:ubuntu-14.04</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/data/db</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then run <code>docker-compose up</code> to run all the containers and start up the server.</p>

<p>&hellip;And that&rsquo;s that! I like setting my code up this way as a compromise between idiomatic Go and ruby on rails. I inject parameters whrever possible to keep things testable. I keep my concerns separated as much as possible. Go is fast and the syntax is clean, but there aren&rsquo;t enough examples of creating full-blown web applications available. At this point, we don&rsquo;t know the future of Go, but I anticipate it becoming big. Hopefully this architecture overview can help someone get started making the transition from a more traditional MVC framework to golang.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/how-i-reactjs/">How to ReactJS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-16T20:03:36-04:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:03 pm</span></time>
        
           | <a href="/blog/2015/06/16/how-i-reactjs/#disqus_thread"
             data-disqus-identifier="https://larry-price.com/blog/2015/06/16/how-i-reactjs/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://facebook.github.io/react/">ReactJS</a> is a component-based Javascript library for creating user interfaces. I used it extensively on recent side project <a href="https://www.refer-madness.com">Refer Madness</a> (<a href="https://github.com/larryprice/refermadness">source code</a>). It&rsquo;s pretty neat. Let&rsquo;s build some demos!</p>

<p>We&rsquo;ll start small. We can start with the ReactJS sample and figure out what&rsquo;s going on:</p>

<iframe style="width: 100%; height: 150px" frameborder="0" seamless="seamless" src="//jsfiddle.net/qqaerhp6/embedded/result,html,js/light/"></iframe>


<p>We create a React component <code>Hello</code> and we tell it what to render. When we create a <code>Hello</code> component, we take in an attribute called <code>name</code> which we then access in our component with <code>this.props.name</code>. When the page loads, React will render the <code>Hello</code> component in the element with ID &ldquo;container&rdquo;.</p>

<p>Components can have other components.</p>

<iframe style="width: 100%; height: 250px" frameborder="0" seamless="seamless" src="//jsfiddle.net/qqaerhp6/4/embedded/result,html,js/light/"></iframe>


<p>I&rsquo;ve created a <code>Name</code> component to show the name. This component uses its children to display any content it needs to. Obviously, this is a bit contrived.</p>

<p>Things get more exciting when we add events. Let&rsquo;s add an event to our <code>Name</code> component: when a user clicks this component, we&rsquo;ll reverse the name.</p>

<iframe style="width: 100%; height: 250px" frameborder="0" seamless="seamless" src="//jsfiddle.net/qqaerhp6/5/embedded/result,html,js/light/"></iframe>


<p>I&rsquo;ve introduced state to the component. When I want a React component to use state, I need to implement the <code>getInitialState</code> method to tell React what the state is when the component is created. In this case, I set the <code>name</code> field of the component&rsquo;s state to <code>this.props.children</code>. When I render the component, I use the <code>name</code> variable I set in my state object. I add an <code>onClick</code> event and call a method on the component called <code>clickme</code>. In <code>clickme</code> I call the built-in <code>setState</code> method and update the <code>name</code> variable on my state object. Any other state variables on the component would remain unchanged. Any time <code>setState</code> is called, <code>render</code> is called again for this component and any children which need to be updated will also rerender.</p>

<p>Sometimes something happens on a child component that the parent cares about. This time, I want the parent component to know when the <code>Name</code> component gets a click event.</p>

<iframe style="width: 100%; height: 250px" frameborder="0" seamless="seamless" src="//jsfiddle.net/qqaerhp6/6/embedded/result,html,js/light/"></iframe>


<p>I&rsquo;ve told my child component to call the method <code>goodbye</code> on the parent element using the property name <code>onClicked</code>. When the method is called Ichange the state of the <code>Hello</code> component and update the greeting; in this case, the <code>Name</code> component will be reused since it hasn&rsquo;t changed.</p>

<p>Just a reminder that you can have multiple of any component; just be sure to not duplicate IDs!</p>

<iframe style="width: 100%; height: 250px" frameborder="0" seamless="seamless" src="//jsfiddle.net/qqaerhp6/7/embedded/result,html,js/light/"></iframe>


<p>I dynamically create as many <code>Name</code> components as I need. I take my list of names and map them all to React components, each of which has a different value. As above, all of these can have events or can call events on the parent component. When we create a list of components, React prefers it when we give them all <code>key</code> attributes. This allows React to cache the components and recreate the appropriate component when states change.</p>

<p>Of course this is just scratching the surface. I used ReactJS because it was fast, stable, and easy to get started learning. It gave me a different way to think about the relationship between my Javascript and the DOM. For a little bit more React you should check out <a href="http://facebook.github.io/react/docs/tutorial.html">the tutorials</a>. If you hadn&rsquo;t noticed, React uses a twist on the Javascript syntax called JSX. If you&rsquo;re into that kind of thing, I&rsquo;ve written about <a href="/blog/2015/06/08/compile-jsx-with-docker/">using Docker to compile your JSX</a> whenever you update your JSX files - very handy IMO.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/7">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <span class="social-media-bar">
    <a href="https://github.com/larryprice" title="Github" alt="github profile"><img src="/images/icon_github.png" class="social-media-icon" /></a>
    <!-- <a href="https://launchpad.net/~larryprice" title="Launchpad" alt="launchpad profile"><img src="/images/icon_lp.png" class="social-media-icon" /></a> -->
    <a href="https://www.patreon.com/larryprice" title="Patreon" alt="patreon profile"><img src="/images/icon_patreon.png" class="social-media-icon" /></a>
    <a href="https://twitter.com/larryrprice" title="Twitter" alt="Twitter profile"><img src="/images/icon_twitter.png" class="social-media-icon" /></a>
    <a href="https://www.linkedin.com/pub/larry-price/3a/630/47b" title="LinkedIn" alt="LinkedIn profile"><img src="/images/icon_linkedin.png" class="social-media-icon" /></a>
    <a href="mailto:larry@larry-price.com" title="Email" alt="email me"><img src="/images/icon_email.png" class="social-media-icon" /></a>
  </span>
</section>
<section>
  <h1>void* Larry</h1>
  <p>I'm a codeslinger debugging from the mean streets of Champaign-Urbana, IL. Welcome to my blog, where I'll tell the tales of wondrous things I discover in the digital jungle.</p>
</section>
<section>
  <h1>Patreon</h1>
  <p>Like what I'm doing? <b><a href="https://www.patreon.com/larryprice">Fund me on Patreon</a></b> so I can keep doing it!</p>
</section>
<section>
  <h1>Go for Web Development</h1>
  <p><strong><a href="https://www.packtpub.com/web-development/go-web-development-video" target="blank">Go for Web Development</a></strong> is an online video series designed by me where you'll follow along to build a personal library app in Go. You'll start with a blank slate but quickly learn to take advantage of popular libraries such as gorilla/mux, negroni, gorp, ace, and bcrypt.</p>
</section>
<section>
  <h1>FOSDEM 2017</h1>
  <p>In 2017, I had the opportunity to give a short talk at FOSDEM in Brussels. I even <strong><a href="https://www.youtube.com/watch?v=FX1fSTOU8Ao&t=1152s" target="blank">recorded an at-home experience</a></strong> with higher quality audio and slides than the livestream.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/06/27/how-to-use-getderivedstatefromprops-in-react-16-dot-3-plus/">How to Use getDerivedStateFromProps in React 16.3+</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/26/quick-start-to-vendor-go-dependencies-with-govendor/">Quick Start to Vendor Go Dependencies With Govendor</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/25/redirecting-to-your-main-site-with-heroku/">Redirecting to Your Main Site With Heroku</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/02/async-and-await-a-new-promise/">Async and Await - a New Promise</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/09/14/promise-youll-call-back/">Promise You'll Call Back: A Guide to the Javascript Promise Class</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/ads' style='font-size: 103.63636363636364%'>ads</a> <a href='/blog/categories/agile' style='font-size: 105.45454545454545%'>agile</a> <a href='/blog/categories/api' style='font-size: 101.81818181818181%'>api</a> <a href='/blog/categories/c-plus-plus' style='font-size: 107.27272727272727%'>c++</a> <a href='/blog/categories/capybara' style='font-size: 105.45454545454545%'>capybara</a> <a href='/blog/categories/css' style='font-size: 103.63636363636364%'>css</a> <a href='/blog/categories/cucumber' style='font-size: 107.27272727272727%'>cucumber</a> <a href='/blog/categories/database' style='font-size: 112.72727272727272%'>database</a> <a href='/blog/categories/dbus' style='font-size: 105.45454545454545%'>dbus</a> <a href='/blog/categories/docker' style='font-size: 107.27272727272727%'>docker</a> <a href='/blog/categories/foreman' style='font-size: 101.81818181818181%'>foreman</a> <a href='/blog/categories/foss' style='font-size: 103.63636363636364%'>foss</a> <a href='/blog/categories/git' style='font-size: 101.81818181818181%'>git</a> <a href='/blog/categories/gmock' style='font-size: 101.81818181818181%'>gmock</a> <a href='/blog/categories/go' style='font-size: 103.63636363636364%'>go</a> <a href='/blog/categories/golang' style='font-size: 118.18181818181819%'>golang</a> <a href='/blog/categories/gtest' style='font-size: 101.81818181818181%'>gtest</a> <a href='/blog/categories/hacks' style='font-size: 101.81818181818181%'>hacks</a> <a href='/blog/categories/haml' style='font-size: 101.81818181818181%'>haml</a> <a href='/blog/categories/heroku' style='font-size: 107.27272727272727%'>heroku</a> <a href='/blog/categories/html' style='font-size: 103.63636363636364%'>html</a> <a href='/blog/categories/html5' style='font-size: 101.81818181818181%'>html5</a> <a href='/blog/categories/internet' style='font-size: 101.81818181818181%'>internet</a> <a href='/blog/categories/javascript' style='font-size: 129.0909090909091%'>javascript</a> <a href='/blog/categories/linux' style='font-size: 110.9090909090909%'>linux</a> <a href='/blog/categories/mongo' style='font-size: 101.81818181818181%'>mongo</a> <a href='/blog/categories/mongodb' style='font-size: 105.45454545454545%'>mongodb</a> <a href='/blog/categories/mongoid' style='font-size: 105.45454545454545%'>mongoid</a> <a href='/blog/categories/mongolab' style='font-size: 101.81818181818181%'>mongolab</a> <a href='/blog/categories/mongoose' style='font-size: 101.81818181818181%'>mongoose</a> <a href='/blog/categories/mvc' style='font-size: 101.81818181818181%'>mvc</a> <a href='/blog/categories/nodejs' style='font-size: 109.0909090909091%'>nodejs</a> <a href='/blog/categories/non-technical' style='font-size: 160.0%'>non-technical</a> <a href='/blog/categories/nosql' style='font-size: 101.81818181818181%'>nosql</a> <a href='/blog/categories/nvm' style='font-size: 101.81818181818181%'>nvm</a> <a href='/blog/categories/octopress' style='font-size: 101.81818181818181%'>octopress</a> <a href='/blog/categories/ollert' style='font-size: 125.45454545454545%'>ollert</a> <a href='/blog/categories/openshift' style='font-size: 101.81818181818181%'>openshift</a> <a href='/blog/categories/php' style='font-size: 101.81818181818181%'>php</a> <a href='/blog/categories/pokephile' style='font-size: 105.45454545454545%'>pokephile</a> <a href='/blog/categories/pony' style='font-size: 101.81818181818181%'>pony</a> <a href='/blog/categories/python' style='font-size: 107.27272727272727%'>python</a> <a href='/blog/categories/qt' style='font-size: 101.81818181818181%'>qt</a> <a href='/blog/categories/rails' style='font-size: 101.81818181818181%'>rails</a> <a href='/blog/categories/react' style='font-size: 103.63636363636364%'>react</a> <a href='/blog/categories/reactjs' style='font-size: 101.81818181818181%'>reactjs</a> <a href='/blog/categories/remote' style='font-size: 107.27272727272727%'>remote</a> <a href='/blog/categories/retro' style='font-size: 112.72727272727272%'>retro</a> <a href='/blog/categories/rspec' style='font-size: 101.81818181818181%'>rspec</a> <a href='/blog/categories/ruby' style='font-size: 130.9090909090909%'>ruby</a> <a href='/blog/categories/rvm' style='font-size: 105.45454545454545%'>rvm</a> <a href='/blog/categories/sass' style='font-size: 101.81818181818181%'>sass</a> <a href='/blog/categories/satire' style='font-size: 101.81818181818181%'>satire</a> <a href='/blog/categories/sendgrid' style='font-size: 101.81818181818181%'>sendgrid</a> <a href='/blog/categories/sep-blog-battle' style='font-size: 114.54545454545455%'>sep-blog-battle</a> <a href='/blog/categories/sequel' style='font-size: 101.81818181818181%'>sequel</a> <a href='/blog/categories/sinatra' style='font-size: 116.36363636363636%'>sinatra</a> <a href='/blog/categories/snappy' style='font-size: 105.45454545454545%'>snappy</a> <a href='/blog/categories/testing' style='font-size: 114.54545454545455%'>testing</a> <a href='/blog/categories/trello' style='font-size: 114.54545454545455%'>trello</a> <a href='/blog/categories/twitter-bootstrap' style='font-size: 103.63636363636364%'>twitter-bootstrap</a> <a href='/blog/categories/ubuntu' style='font-size: 118.18181818181819%'>ubuntu</a> <a href='/blog/categories/unity' style='font-size: 101.81818181818181%'>unity</a> <a href='/blog/categories/upstart' style='font-size: 101.81818181818181%'>upstart</a> <a href='/blog/categories/web' style='font-size: 141.8181818181818%'>web</a> <a href='/blog/categories/write-ups' style='font-size: 143.63636363636363%'>write-ups</a> <a href='/blog/categories/xml' style='font-size: 101.81818181818181%'>xml</a> </span>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/larryprice">@larryprice</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'larryprice',
            count: 5,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <style>
    .sidebar-ad { width: 280px; height: 280px; }}
    @media(min-width: 375px) { .sidebar-ad { width: 350px; height: 90px; } }
    @media(min-width: 475px) { .sidebar-ad { width: 450px; height: 90px; } }
    @media(min-width: 575px) { .sidebar-ad { width: 550px; height: 90px; } }
    @media(min-width: 675px) { .sidebar-ad { width: 650px; height: 90px; } }
    @media(min-width: 750px) { .sidebar-ad { width: 200px; height: 200px; } }
    @media(min-width: 768px) { .sidebar-ad { width: 210px; height: 210px; } }
    @media(min-width: 1280px) { .sidebar-ad { width: 260px; height: 260px; } }
  </style>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Sidebar Ad -->
    <ins class="adsbygoogle sidebar-ad"
         style="display:inline-block"
         data-ad-client="ca-pub-6961096698495477"
         data-ad-slot="8892886941"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <center>
	  Copyright &copy; 2018 - Larry Price -
	  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span><br/>
	  Note: Views and opinions expressed belong solely to the author and do not represent the views of the any other person or company.
	</center>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'larryprice';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
