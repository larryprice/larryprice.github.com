<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Larry Price]]></title>
  <link href="http://larryprice.github.com/atom.xml" rel="self"/>
  <link href="http://larryprice.github.com/"/>
  <updated>2012-10-30T21:38:16-04:00</updated>
  <id>http://larryprice.github.com/</id>
  <author>
    <name><![CDATA[Larry Price]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Good Idea, Bad Idea]]></title>
    <link href="http://larryprice.github.com/blog/2012/10/30/good-idea-bad-idea/"/>
    <updated>2012-10-30T21:37:00-04:00</updated>
    <id>http://larryprice.github.com/blog/2012/10/30/good-idea-bad-idea</id>
    <content type="html"><![CDATA[<p>There is a general, unnamed rule when coming up with ideas:</p>

<p><strong><em>A person is required to have one or more bad ideas before having a single good idea</em></strong>.</p>

<p>Since this rule is unnamed, it shall henceforth be referred to as Larry&#8217;s Law.</p>

<p>Note that the thinker in question is not limited to just one bad idea under Larry&#8217;s Law, but as many as he so desires. Also note that Larry&#8217;s Law does not imply that the thinker will necessarily ever have any good ideas.</p>

<p>Having bad ideas is necessary. Bad ideas let the brain see what it shouldn&#8217;t be thinking about, which has the potential to lead to good ideas. Then again, many bad ideas may just spawn more bad ideas. That&#8217;s just Larry&#8217;s Law.</p>

<h3>Examples</h3>

<p>You sit down at your desk and pick up a bug. Your first idea doesn&#8217;t fix the code. Your second idea doesn&#8217;t compile. Your third idea breaks all 3400 unit tests in the test suite. Your fourth idea is a complete hack. Your fifth idea breaks some other component of the application. Your sixth idea seems genius to you but doesn&#8217;t survive the code review. Your seventh idea is a winner.</p>

<p>Before Edison could invent the <a href="http://edison.rutgers.edu/ticker.htm">Universal Stock Ticker</a>, he had to invent a <a href="http://edison.rutgers.edu/vote.htm">crummy vote recorder</a>.</p>

<p>Do you have any idea the number of albums Pink Floyd released before <a href="http://en.wikipedia.org/wiki/The_Dark_Side_of_the_Moon"><em>The Dark Side of the Moon</em></a>? <a href="http://en.wikipedia.org/wiki/Pink_Floyd_discography">Seven</a>. Don&#8217;t kid yourself: these seven albums were not gems. But don&#8217;t fret! Larry&#8217;s Law states that these albums had to be low quality to allow <em>The Dark Side of the Moon</em> to be a monumental album.</p>

<p>Someone invented <a href="http://en.wikipedia.org/wiki/New_coke">New Coke</a>. This is an instance of someone making a bad decision without any corresponding good decisions.</p>

<p>Domino&#8217;s pizza was <a href="http://www.nowpublic.com/culture/pizza-turnaround-dominos-pizza-knows-they-suck-2555951.html">terrible</a> until very recently. Now it&#8217;s delicious, at least according to <a href="http://answers.yahoo.com/question/index?qid=20110609112806AABnOTo">this man on Yahoo! Answers</a>.</p>

<p>A group of people wants to go out to eat. Jon Doe will suggest Jimmy John&#8217;s, then Penn Station, McDonald&#8217;s, Five Guys, Taco Bell, and Denny&#8217;s. Finally Jon Doe offers a reasonable idea, like YATS. This process will now be repeated by every person in the group, and the best decision will never become visible. And Larry&#8217;s Law specifies that the group may never come to a good decision, and will probably end up eating at Five Guys.</p>

<h3>Conclusion</h3>

<p>The next time you have a bad idea, embrace it. Realize that having that bad idea might clear space in your head for a good idea. Or possibly an infinite number of bad ideas. Either way, that&#8217;s just Larry&#8217;s Law.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I Don't Have Time]]></title>
    <link href="http://larryprice.github.com/blog/2012/10/24/i-dont-have-time/"/>
    <updated>2012-10-24T22:35:00-04:00</updated>
    <id>http://larryprice.github.com/blog/2012/10/24/i-dont-have-time</id>
    <content type="html"><![CDATA[<p>&#8220;Wanna go for a walk?&#8221; my wife asks over my shoulder.</p>

<p>&#8220;I don&#8217;t have time for your walks, woman! I&#8217;ve got a city to run!&#8221; I exclaim as I frantically move the mouse around the screen to raise taxes on the rich so I can afford to build another statue of myself in the blossoming city of Velcro. I&#8217;d been absolutely engulfed in the popular city simulator <a href="http://en.wikipedia.org/wiki/Simcity_4"><em>SimCity 4</em></a> for about five hours already that day. Needless to say, my wife &#8220;convinced&#8221; me to hit the pause button on the game and join her back in reality, where I&#8217;m a software developer who has to go on walks to counter his poor eating habits.</p>

<p>We take time too seriously.</p>

<p>When we feel like we don&#8217;t have enough time, we complain. When we feel like we have too much time, we think we&#8217;re bored, and so we complain about that.</p>

<p>Maybe if we spent less time complaining, we&#8217;d have time to see how ridiculous we are.</p>

<p>Time is time. What&#8217;s there is there, and we&#8217;re not getting any more or less of it based on what we get accomplished in a given day.</p>

<p>&#8230;Unless of course what you accomplish is manipulating time in some manner. Or you create a serum to slow/expediate/stop the aging process. But those are side projects to talk about in another blog post on another day.</p>

<p>Back to <em>SimCity 4</em>. After I rediscovered the dusty game disc at my parents&#8217; house, the game completely absorbed me, even 10 years after it was originally released (my computer is finally powerful enough to play it). I didn&#8217;t mind that it was taking up so much of my time. I had a myriad of more conventional things I wanted to do that weekend: side projects to work on, books to read, TV shows to watch, internets to check, housework to do, groceries to buy, and meals to cook; but none of that mattered.</p>

<p>I repeat: none of that important-sounding stuff mattered. I had stumbled upon this completely arbitrary childhood memory to relive, so everything else took a back seat. I don&#8217;t regret all the hours I ended up spending on that game, as a kid or as an adult. A compulsive opportunity arose to have some fun and I snatched it up. I stopped worrying about time and decided to just enjoy myself. You should try it sometime. We spend way too much of our time trying to abide by our schedules and to-do lists. The best parts of life are when you stumble upon something that makes you completely forget what you were doing before you found it, and then continues to obliterate any plans you might have had for the rest of the day.</p>

<p>Now if you&#8217;ll excuse me, I have a city to run.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A Hacky Solution to the Unicode data in a Unicode-only collation problem]]></title>
    <link href="http://larryprice.github.com/blog/2012/10/19/a-hacky-solution-to-the-unicode-data-in-a-unicode-only-collation-problem/"/>
    <updated>2012-10-19T17:23:00-04:00</updated>
    <id>http://larryprice.github.com/blog/2012/10/19/a-hacky-solution-to-the-unicode-data-in-a-unicode-only-collation-problem</id>
    <content type="html"><![CDATA[<h2>The Issue Rises <a id="problem"></a></h2>

<p>Earlier this week a defect was found in my application. A defect that I could have sworn I fixed several weeks ago and written about in a <a href="http://nullablevoid.blogspot.com/2012/10/unicode-data-in-unicode-only-collation.html">previous blog post</a>. Let me start from the beginning:</p>

<h4>The Setup</h4>

<p>The application is a web app using Rails 3.2, MSSQL Server for the database, and Tiny-TDS for database communications from the CloudFoundry server. There are three different types of builds and three databases I access: development (for development, obviously), staging (for testing), and production (for the users to complain about, mostly).</p>

<h4>The Original Issue</h4>

<p>I inherited this code and ran it on my dev build with no issues. Upon doing some testing with the staging build, the page crashed. The logs revealed the following (horrible) error:</p>

<figure class='code'><figcaption><span>Vague error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Unicode</span> <span class="n">data</span> <span class="k">in</span> <span class="n">a</span> <span class="no">Unicode</span><span class="o">-</span><span class="n">only</span> <span class="n">collation</span> <span class="ow">or</span> <span class="n">ntext</span> <span class="n">data</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">clients</span> <span class="n">using</span> <span class="no">DB</span><span class="o">-</span><span class="no">Library</span> <span class="p">(</span><span class="n">such</span> <span class="n">as</span> <span class="no">ISQL</span><span class="p">)</span> <span class="ow">or</span> <span class="no">ODBC</span> <span class="n">version</span> <span class="mi">3</span><span class="o">.</span><span class="mi">7</span> <span class="ow">or</span> <span class="n">earlier</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>What does this mean? Well. Beats me. <a href="http://dirk.net/2010/09/18/sql-server-with-freetds-unicode-data-error/">Several</a> <a href="http://stackoverflow.com/questions/5414890/mssql-query-issue-in-php-and-querying-text-data">sources</a> had <a href="http://stackoverflow.com/questions/8705008/tiny-tds-error-on-heroku-connecting-to-sqlserver-db">similar</a> <a href="http://findyourscript.com/index.php/2011/05/20/unicode-data-in-a-unicode-only-collation-or-ntext-data-cannot-be-sent-to-clients-using-db-library/">issues</a> and the ones I liked eventually came to the conclusion that ntext and nvarchar variables in the database were ticking off the host server. <a href="http://msdn.microsoft.com/en-us/library/ms186939.aspx">Apparently</a>, text variables are translated to nvarchar(MAX), where MAX is something like 2GB of data. I hunted through my database and, sure enough, the &#8216;Narrative&#8217; column was an nvarchar(MAX).</p>

<h4>The Original Fix</h4>

<p>Based on the mighty power of the internet, I decided that the best thing for me to do was to change the variable in the database from a &#8220;text&#8221; to a &#8220;string&#8221; with a limit of 8000 (which translates to varchar(8000)) using this migration:</p>

<figure class='code'><figcaption><span>Simple migration</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ChangeNarrativeColumnToVarChar</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">change_column</span> <span class="ss">:evaluation</span><span class="p">,</span> <span class="ss">:narrative</span><span class="p">,</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">8000</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I ran through my repro steps and&#8230; Drumroll&#8230; Suspense&#8230; It worked! Or so it appeared. I went to the narrative textbox and put some words in it, saved, and confirmed that everything was great. Then I pushed it to production and heard nothing for two weeks.</p>

<h2>Failure Is Always An Option <a id="failure"></a></h2>

<p>Too bad that wasn&#8217;t the end of the story. This week my users finally started using the app again. They found all kinds of defects, of course, but one in particular that caught me off guard: When viewing the narrative text, which we had &#8220;fixed&#8221; using that little migration above, the text cut off to about two lines. Two lines? I never really bothered to test more than a couple words or a short, goofy phrase. So I opened up the app on my dev build and it worked great with up to 8000 characters. I switched over to the staging build and was able to reproduce the error immediately.</p>

<p>At first I thought it was just the test_area, but I was wrong. Even static fields which displayed narrative cut off text. After some testing, the text was always cut off to 255 characters. I watched the SQL logs and confirmed that all 8000 characters would come back from the SQL queries. I looked in the database and verified the data was still present. What was going on?</p>

<h4>Dear Rails: Oh, you</h4>

<p>I thought and eventually realized something: the default of a &#8220;string&#8221; in Rails is 255 characters. Rails was cutting off my text. Curse you, Rails, I trusted you with my heart!</p>

<h4>The Fix</h4>

<p>Alright. The fix. Unfortunately, the fix sucks. In my app, I had to get the whole model that contained a narrative. Doing only that, the narrative would be cut short. So then I had to get the narrative again, and this time cast that sucker to a &#8220;text.&#8221;</p>

<figure class='code'><figcaption><span>< 1337 Hax</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@eval</span> <span class="o">=</span> <span class="no">Evaluation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:id</span> <span class="o">=&gt;</span> <span class="nb">id</span><span class="p">)</span>
</span><span class='line'><span class="vi">@eval</span><span class="o">.</span><span class="n">narrative</span> <span class="o">=</span> <span class="no">Evaluation</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;id as id, CAST(narrative as text) as narrative&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:id</span> <span class="o">=&gt;</span> <span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">narrative</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&#8217;s a part of me that likes sensible, clean code. This code did not come from that part of me. If you really want, you can do a select and get all the columns of your model, and then case the field in question, but what if your columns change? I didn&#8217;t want to be responsible for that, especially after I hand this code off to someone else in the coming weeks.</p>
]]></content>
  </entry>
  
</feed>
