<div class="highlight"><pre><span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span><span class="nb">require</span> <span class="s1">&#39;mongo&#39;</span><span class="o">&lt;</span><span class="sr">/s&gt;</span>
<span class="sr">require &#39;mongoid&#39;</span>
<span class="sr">require &#39;nokogiri&#39;</span>
<span class="sr">require &#39;open-uri&#39;</span>

<span class="sr">class Populater</span>
<span class="sr">  def initialize(db_name)</span>
<span class="sr">      @col = Mongo::Connection.new.db(db_name)[&quot;pokemons&quot;]</span>
<span class="sr">      @col.remove</span>
<span class="sr">      @data = Nokogiri::HTML(open(&quot;http:/</span><span class="o">/</span><span class="n">pokemon</span><span class="o">.</span><span class="n">wikia</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="no">List_of_Pok</span><span class="o">%</span><span class="no">C3</span><span class="o">%</span><span class="no">A9mon</span><span class="s2">&quot;))</span>
<span class="s2">  end</span>

<span class="s2">  def add_pokemon(num_to_add)</span>
<span class="s2">    @data.xpath(&quot;</span><span class="o">//</span><span class="n">table</span><span class="o">[</span><span class="vi">@class</span><span class="o">=</span><span class="s1">&#39;wikitable sortable&#39;</span><span class="o">]/</span><span class="n">tr</span><span class="s2">&quot;).each do |row|</span>
<span class="s2">        break if num_to_add &lt;= 0</span>
<span class="s2">        dex_num = row.at_xpath(&#39;td/text()&#39;).to_s.strip</span>
<span class="s2">        next if dex_num.nil? || dex_num.empty?</span>
<span class="s2">        dex_name = row.at_xpath(&#39;td[2]/a/text()&#39;).to_s.strip</span>

<span class="s2">        unless dex_num == &quot;</span><span class="mo">000</span><span class="s2">&quot;</span>
<span class="s2">            type_1 = row.at_xpath(&#39;td[4]/a/span/text()&#39;).to_s.strip</span>
<span class="s2">            type_2 = row.at_xpath(&#39;td[5]/a/span/text()&#39;).to_s.strip || row.at_xpath(&#39;td[5]/text()&#39;).to_s.strip</span>
<span class="s2">            image_link = &quot;</span><span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">img</span><span class="o">.</span><span class="n">pokemondb</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">artwork</span><span class="o">/</span><span class="c1">#{dex_name.downcase}.jpg&quot;</span>
        <span class="k">else</span>
            <span class="n">type_1</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">&#39;td[4]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">strip</span>
            <span class="n">type_2</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">at_xpath</span><span class="p">(</span><span class="s1">&#39;td[5]/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">strip</span>
            <span class="n">image_link</span> <span class="o">=</span> <span class="s2">&quot;images/missingo.png&quot;</span>
        <span class="k">end</span>

        <span class="n">types</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
        <span class="n">types</span> <span class="o">&lt;&lt;</span> <span class="n">type_1</span> <span class="k">unless</span> <span class="n">type_1</span><span class="o">.</span><span class="n">nil?</span> <span class="o">||</span> <span class="n">type_1</span><span class="o">.</span><span class="n">empty?</span>
        <span class="n">types</span> <span class="o">&lt;&lt;</span> <span class="n">type_2</span> <span class="k">unless</span> <span class="n">type_2</span><span class="o">.</span><span class="n">nil?</span> <span class="o">||</span> <span class="n">type_2</span><span class="o">.</span><span class="n">empty?</span>

        <span class="vi">@col</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="ss">:number</span> <span class="o">=&gt;</span> <span class="n">dex_num</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">dex_name</span><span class="p">,</span> <span class="ss">:types</span> <span class="o">=&gt;</span> <span class="n">types</span><span class="p">,</span> <span class="ss">:image</span> <span class="o">=&gt;</span> <span class="n">image_link</span><span class="p">})</span>

        <span class="n">num_to_add</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
